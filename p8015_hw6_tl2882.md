p8015\_hw6\_tl2882
================

Problem 1
=========

Tidy data
---------

``` r
data = 
  read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") %>% 
  unite(city_state, city, state, sep = ", ") %>% 
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>% 
  mutate(bi_disposition = as.numeric(disposition == "Closed by arrest")) %>% 
  mutate(victim_race = ifelse(victim_race == "White", "white", "non-white") ) %>% 
  mutate(victim_race = fct_relevel(victim_race, "white")) %>% 
  mutate(victim_age = as.numeric(victim_age))
```

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

Model for Baltimore, MD
-----------------------

``` r
model = glm(bi_disposition ~ victim_age + victim_sex + victim_race, 
            data = filter(data, city_state == "Baltimore, MD"), family = binomial(link = "logit"))
result = broom::tidy(model, conf.int = TRUE)

result %>% 
  filter(term == "victim_racenon-white") %>%
  mutate(odds_ratio = exp(estimate), 
         conf_low = exp(conf.low), conf_high = exp(conf.high)) %>% 
  select(odds_ratio, conf_low, conf_high) %>% 
  knitr::kable()
```

|  odds\_ratio|  conf\_low|  conf\_high|
|------------:|----------:|-----------:|
|     0.440608|  0.3121625|   0.6196693|

This is the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed.

Model for each city
-------------------

``` r
data_results = 
  data %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(models = map(data, ~glm(bi_disposition ~ victim_age + victim_sex + victim_race, 
                                data = .x, family = binomial(link = "logit")))) %>% 
  mutate(results = map(models, broom::tidy)) %>% 
  mutate(results_ci = map(models, broom::confint_tidy)) %>% 
  select(-data, -models) %>% 
  unnest() 
```

``` r
results_ci = 
  data_results %>% 
  filter(term == "victim_racenon-white") %>% 
  mutate(odds_ratio = exp(estimate), 
         conf_low = exp(conf.low), conf_high = exp(conf.high)) %>% 
  select(city_state, odds_ratio, conf_low, conf_high)

results_ci
```

    ## # A tibble: 47 x 4
    ##    city_state      odds_ratio conf_low conf_high
    ##    <chr>                <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM      0.741   0.449      1.22 
    ##  2 Atlanta, GA          0.753   0.424      1.30 
    ##  3 Baltimore, MD        0.441   0.312      0.620
    ##  4 Baton Rouge, LA      0.668   0.304      1.41 
    ##  5 Birmingham, AL       1.04    0.612      1.75 
    ##  6 Boston, MA           0.115   0.0425     0.259
    ##  7 Buffalo, NY          0.390   0.210      0.710
    ##  8 Charlotte, NC        0.558   0.313      0.951
    ##  9 Chicago, IL          0.562   0.432      0.734
    ## 10 Cincinnati, OH       0.318   0.180      0.541
    ## # ... with 37 more rows

This is the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed.

### Plot

``` r
results_ci %>% 
  mutate(city_state = fct_reorder(city_state, odds_ratio)) %>%
  ggplot(aes(x = city_state, weight = odds_ratio)) +
    geom_bar() + 
    geom_errorbar(aes(ymin = conf_low, ymax = conf_high), width = 0.5) +
    labs(title = "The estimates ORs and CIs for each city", y = "Proportion") +
    theme(axis.text.x = element_text(angle = -90))
```

![](p8015_hw6_tl2882_files/figure-markdown_github/unnamed-chunk-1-1.png)

This is the plot that shows the estimated ORs and CIs for each city
